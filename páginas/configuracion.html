<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Configuraci칩n</title>
  <link rel="stylesheet" href="styles-configuracion.css" />
</head>
<body>
  <div class="container">
    <h1>Configuraci칩n de Usuario</h1>

    <div class="user-section">
      <img id="imagenActual" src="" alt="Imagen Actual" class="user-image" />
      <input type="file" id="nuevaImagen" accept="image/*" style="display: none;" />
      <button id="cambiarImagenBtn">Cambiar Imagen</button>
    </div>

    <div class="info-section">
      <label for="nuevoUsuario">Usuario:</label>
      <input type="text" id="nuevoUsuario" />

      <label for="nuevaContrasena">Contrase침a:</label>
      <input type="password" id="nuevaContrasena" />

      <div class="buttons">
        <button id="guardarBtn">Guardar Cambios</button>
        <button onclick="window.location.href='principal.html'">Volver</button>
      </div>
    </div>
  </div>

  <script>
    const usuarios = JSON.parse(localStorage.getItem("usuarios")) || {};
    const usuarioActual = localStorage.getItem("usuario");
    const contrasenaActual = usuarios[usuarioActual];
    const imagenGuardada = localStorage.getItem("imagenUsuario");

    const imagenActual = document.getElementById("imagenActual");
    const inputUsuario = document.getElementById("nuevoUsuario");
    const inputContrasena = document.getElementById("nuevaContrasena");

    inputUsuario.value = usuarioActual;
    inputContrasena.value = contrasenaActual;
    imagenActual.src = imagenGuardada || "imagenes/marlon.jpeg";

    document.getElementById("cambiarImagenBtn").addEventListener("click", () => {
      document.getElementById("nuevaImagen").click();
    });

    document.getElementById("nuevaImagen").addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) {
        // Verificar tipo de archivo
        if (!file.type.startsWith('image/')) {
          alert("Por favor, selecciona una imagen v치lida.");
          return;
        }
        const reader = new FileReader();
        reader.onload = function (event) {
          imagenActual.src = event.target.result;
          localStorage.setItem("imagenUsuario", event.target.result);
        };
        reader.readAsDataURL(file);
      }
    });

    document.getElementById("guardarBtn").addEventListener("click", () => {
      const nuevoUsuario = inputUsuario.value.trim();
      const nuevaContrasena = inputContrasena.value.trim();

      if (!nuevoUsuario || !nuevaContrasena) {
        alert("Todos los campos son obligatorios.");
        return;
      }

      if (nuevoUsuario !== usuarioActual) {
        usuarios[nuevoUsuario] = nuevaContrasena;
        delete usuarios[usuarioActual];
        localStorage.setItem("usuario", nuevoUsuario);
      } else {
        usuarios[usuarioActual] = nuevaContrasena;
      }

      localStorage.setItem("usuarios", JSON.stringify(usuarios));
      alert("Cambios guardados correctamente.");
      window.location.href = "principal.html";
    });
  </script>
</body>
</html>
